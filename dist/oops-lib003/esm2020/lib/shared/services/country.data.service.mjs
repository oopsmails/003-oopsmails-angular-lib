import { Injectable } from '@angular/core';
import { BehaviorSubject, of, Subject } from 'rxjs';
import { debounceTime, delay, switchMap, tap } from 'rxjs/operators';
import { COUNTRIES } from '../data/countries.data';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
function compare(v1, v2) {
    return v1 < v2 ? -1 : v1 > v2 ? 1 : 0;
}
function sort(countries, column, direction) {
    if (direction === '') {
        return countries;
    }
    else {
        return [...countries].sort((a, b) => {
            const res = compare(a[column], b[column]);
            return direction === 'asc' ? res : -res;
        });
    }
}
function matches(CountryLib003, term, pipe) {
    return (CountryLib003.name.toLowerCase().includes(term) ||
        pipe.transform(CountryLib003.area).includes(term) ||
        pipe.transform(CountryLib003.population).includes(term));
}
export class CountryDataServiceLib003 {
    constructor(pipe) {
        this.pipe = pipe;
        this.COMPONENT_NAME = 'CountryLib003DataService';
        this._loading$ = new BehaviorSubject(true);
        this._search$ = new Subject();
        this._countries$ = new BehaviorSubject([]);
        this._total$ = new BehaviorSubject(0);
        this._state = {
            page: 1,
            pageSize: 4,
            searchTerm: '',
            sortColumn: '',
            sortDirection: '',
        };
        this._search$
            .pipe(tap(() => this._loading$.next(true)), debounceTime(200), switchMap(() => this._search()), delay(200), tap(() => this._loading$.next(false)))
            .subscribe((result) => {
            this._countries$.next(result.countries);
            this._total$.next(result.total);
        });
        this._search$.next();
    }
    get countries$() {
        console.log(this.COMPONENT_NAME + ', calling get countries$ ..... ');
        return this._countries$.asObservable();
    }
    get total$() {
        return this._total$.asObservable();
    }
    get loading$() {
        return this._loading$.asObservable();
    }
    get page() {
        return this._state.page;
    }
    get pageSize() {
        return this._state.pageSize;
    }
    get searchTerm() {
        return this._state.searchTerm;
    }
    set page(page) {
        this._set({ page });
    }
    set pageSize(pageSize) {
        this._set({ pageSize });
    }
    set searchTerm(searchTerm) {
        this._set({ searchTerm });
    }
    set sortColumn(sortColumn) {
        this._set({ sortColumn });
    }
    set sortDirection(sortDirection) {
        this._set({ sortDirection });
    }
    _set(patch) {
        Object.assign(this._state, patch);
        this._search$.next();
    }
    _search() {
        const { sortColumn, sortDirection, pageSize, page, searchTerm } = this._state;
        // 1. sort
        let countries = sort(COUNTRIES, sortColumn, sortDirection);
        // 2. filter
        countries = countries.filter((CountryLib003) => matches(CountryLib003, searchTerm, this.pipe));
        const total = countries.length;
        // 3. paginate
        countries = countries.slice((page - 1) * pageSize, (page - 1) * pageSize + pageSize);
        return of({ countries, total });
    }
}
CountryDataServiceLib003.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "14.2.12", ngImport: i0, type: CountryDataServiceLib003, deps: [{ token: i1.DecimalPipe }], target: i0.ɵɵFactoryTarget.Injectable });
CountryDataServiceLib003.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "14.2.12", ngImport: i0, type: CountryDataServiceLib003, providedIn: 'root' });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "14.2.12", ngImport: i0, type: CountryDataServiceLib003, decorators: [{
            type: Injectable,
            args: [{ providedIn: 'root' }]
        }], ctorParameters: function () { return [{ type: i1.DecimalPipe }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY291bnRyeS5kYXRhLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9vb3BzLWxpYjAwMy9zcmMvbGliL3NoYXJlZC9zZXJ2aWNlcy9jb3VudHJ5LmRhdGEuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFpQixNQUFNLGVBQWUsQ0FBQztBQUMxRCxPQUFPLEVBQUUsZUFBZSxFQUFjLEVBQUUsRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFFaEUsT0FBTyxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3JFLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQzs7O0FBaUJuRCxTQUFTLE9BQU8sQ0FBQyxFQUFFLEVBQUUsRUFBRTtJQUNyQixPQUFPLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUN4QyxDQUFDO0FBRUQsU0FBUyxJQUFJLENBQUMsU0FBMEIsRUFBRSxNQUFjLEVBQUUsU0FBaUI7SUFDekUsSUFBSSxTQUFTLEtBQUssRUFBRSxFQUFFO1FBQ3BCLE9BQU8sU0FBUyxDQUFDO0tBQ2xCO1NBQU07UUFDTCxPQUFPLENBQUMsR0FBRyxTQUFTLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUU7WUFDbEMsTUFBTSxHQUFHLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztZQUMxQyxPQUFPLFNBQVMsS0FBSyxLQUFLLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUM7UUFDMUMsQ0FBQyxDQUFDLENBQUM7S0FDSjtBQUNILENBQUM7QUFFRCxTQUFTLE9BQU8sQ0FBQyxhQUE0QixFQUFFLElBQVksRUFBRSxJQUFtQjtJQUM5RSxPQUFPLENBQ0wsYUFBYSxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDO1FBQy9DLElBQUksQ0FBQyxTQUFTLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUM7UUFDakQsSUFBSSxDQUFDLFNBQVMsQ0FBQyxhQUFhLENBQUMsVUFBVSxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUN4RCxDQUFDO0FBQ0osQ0FBQztBQUdELE1BQU0sT0FBTyx3QkFBd0I7SUFlbkMsWUFBb0IsSUFBaUI7UUFBakIsU0FBSSxHQUFKLElBQUksQ0FBYTtRQWQ3QixtQkFBYyxHQUFHLDBCQUEwQixDQUFDO1FBQzVDLGNBQVMsR0FBRyxJQUFJLGVBQWUsQ0FBVSxJQUFJLENBQUMsQ0FBQztRQUMvQyxhQUFRLEdBQUcsSUFBSSxPQUFPLEVBQVEsQ0FBQztRQUMvQixnQkFBVyxHQUFHLElBQUksZUFBZSxDQUFrQixFQUFFLENBQUMsQ0FBQztRQUN2RCxZQUFPLEdBQUcsSUFBSSxlQUFlLENBQVMsQ0FBQyxDQUFDLENBQUM7UUFFekMsV0FBTSxHQUFVO1lBQ3RCLElBQUksRUFBRSxDQUFDO1lBQ1AsUUFBUSxFQUFFLENBQUM7WUFDWCxVQUFVLEVBQUUsRUFBRTtZQUNkLFVBQVUsRUFBRSxFQUFFO1lBQ2QsYUFBYSxFQUFFLEVBQUU7U0FDbEIsQ0FBQztRQUdBLElBQUksQ0FBQyxRQUFRO2FBQ1YsSUFBSSxDQUNILEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUNwQyxZQUFZLENBQUMsR0FBRyxDQUFDLEVBQ2pCLFNBQVMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUMsRUFDL0IsS0FBSyxDQUFDLEdBQUcsQ0FBQyxFQUNWLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUN0QzthQUNBLFNBQVMsQ0FBQyxDQUFDLE1BQU0sRUFBRSxFQUFFO1lBQ3BCLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUN4QyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDbEMsQ0FBQyxDQUFDLENBQUM7UUFFTCxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ3ZCLENBQUM7SUFFRCxJQUFJLFVBQVU7UUFDWixPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxjQUFjLEdBQUcsaUNBQWlDLENBQUMsQ0FBQztRQUNyRSxPQUFPLElBQUksQ0FBQyxXQUFXLENBQUMsWUFBWSxFQUFFLENBQUM7SUFDekMsQ0FBQztJQUNELElBQUksTUFBTTtRQUNSLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxZQUFZLEVBQUUsQ0FBQztJQUNyQyxDQUFDO0lBQ0QsSUFBSSxRQUFRO1FBQ1YsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLFlBQVksRUFBRSxDQUFDO0lBQ3ZDLENBQUM7SUFDRCxJQUFJLElBQUk7UUFDTixPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDO0lBQzFCLENBQUM7SUFDRCxJQUFJLFFBQVE7UUFDVixPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDO0lBQzlCLENBQUM7SUFDRCxJQUFJLFVBQVU7UUFDWixPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDO0lBQ2hDLENBQUM7SUFFRCxJQUFJLElBQUksQ0FBQyxJQUFZO1FBQ25CLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO0lBQ3RCLENBQUM7SUFDRCxJQUFJLFFBQVEsQ0FBQyxRQUFnQjtRQUMzQixJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsUUFBUSxFQUFFLENBQUMsQ0FBQztJQUMxQixDQUFDO0lBQ0QsSUFBSSxVQUFVLENBQUMsVUFBa0I7UUFDL0IsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLFVBQVUsRUFBRSxDQUFDLENBQUM7SUFDNUIsQ0FBQztJQUNELElBQUksVUFBVSxDQUFDLFVBQWtCO1FBQy9CLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxVQUFVLEVBQUUsQ0FBQyxDQUFDO0lBQzVCLENBQUM7SUFDRCxJQUFJLGFBQWEsQ0FBQyxhQUE0QjtRQUM1QyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsYUFBYSxFQUFFLENBQUMsQ0FBQztJQUMvQixDQUFDO0lBRU8sSUFBSSxDQUFDLEtBQXFCO1FBQ2hDLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxLQUFLLENBQUMsQ0FBQztRQUNsQyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ3ZCLENBQUM7SUFFTyxPQUFPO1FBQ2IsTUFBTSxFQUFFLFVBQVUsRUFBRSxhQUFhLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUUsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDO1FBRTlFLFVBQVU7UUFDVixJQUFJLFNBQVMsR0FBRyxJQUFJLENBQUMsU0FBUyxFQUFFLFVBQVUsRUFBRSxhQUFhLENBQUMsQ0FBQztRQUUzRCxZQUFZO1FBQ1osU0FBUyxHQUFHLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxhQUFhLEVBQUUsRUFBRSxDQUFDLE9BQU8sQ0FBQyxhQUFhLEVBQUUsVUFBVSxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQy9GLE1BQU0sS0FBSyxHQUFHLFNBQVMsQ0FBQyxNQUFNLENBQUM7UUFFL0IsY0FBYztRQUNkLFNBQVMsR0FBRyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQyxHQUFHLFFBQVEsRUFBRSxDQUFDLElBQUksR0FBRyxDQUFDLENBQUMsR0FBRyxRQUFRLEdBQUcsUUFBUSxDQUFDLENBQUM7UUFDckYsT0FBTyxFQUFFLENBQUMsRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztJQUNsQyxDQUFDOztzSEF0RlUsd0JBQXdCOzBIQUF4Qix3QkFBd0IsY0FEWCxNQUFNOzRGQUNuQix3QkFBd0I7a0JBRHBDLFVBQVU7bUJBQUMsRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgUGlwZVRyYW5zZm9ybSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QsIE9ic2VydmFibGUsIG9mLCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IERlY2ltYWxQaXBlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcclxuaW1wb3J0IHsgZGVib3VuY2VUaW1lLCBkZWxheSwgc3dpdGNoTWFwLCB0YXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IENPVU5UUklFUyB9IGZyb20gJy4uL2RhdGEvY291bnRyaWVzLmRhdGEnO1xyXG5pbXBvcnQgeyBDb3VudHJ5TGliMDAzIH0gZnJvbSAnLi4vbW9kZWxzJztcclxuaW1wb3J0IHsgU29ydERpcmVjdGlvbiB9IGZyb20gJy4uL2RpcmVjdGl2ZXMvc29ydGFibGUuZGlyZWN0aXZlJztcclxuXHJcbmludGVyZmFjZSBTZWFyY2hSZXN1bHQge1xyXG4gIGNvdW50cmllczogQ291bnRyeUxpYjAwM1tdO1xyXG4gIHRvdGFsOiBudW1iZXI7XHJcbn1cclxuXHJcbmludGVyZmFjZSBTdGF0ZSB7XHJcbiAgcGFnZTogbnVtYmVyO1xyXG4gIHBhZ2VTaXplOiBudW1iZXI7XHJcbiAgc2VhcmNoVGVybTogc3RyaW5nO1xyXG4gIHNvcnRDb2x1bW46IHN0cmluZztcclxuICBzb3J0RGlyZWN0aW9uOiBTb3J0RGlyZWN0aW9uO1xyXG59XHJcblxyXG5mdW5jdGlvbiBjb21wYXJlKHYxLCB2Mikge1xyXG4gIHJldHVybiB2MSA8IHYyID8gLTEgOiB2MSA+IHYyID8gMSA6IDA7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNvcnQoY291bnRyaWVzOiBDb3VudHJ5TGliMDAzW10sIGNvbHVtbjogc3RyaW5nLCBkaXJlY3Rpb246IHN0cmluZyk6IENvdW50cnlMaWIwMDNbXSB7XHJcbiAgaWYgKGRpcmVjdGlvbiA9PT0gJycpIHtcclxuICAgIHJldHVybiBjb3VudHJpZXM7XHJcbiAgfSBlbHNlIHtcclxuICAgIHJldHVybiBbLi4uY291bnRyaWVzXS5zb3J0KChhLCBiKSA9PiB7XHJcbiAgICAgIGNvbnN0IHJlcyA9IGNvbXBhcmUoYVtjb2x1bW5dLCBiW2NvbHVtbl0pO1xyXG4gICAgICByZXR1cm4gZGlyZWN0aW9uID09PSAnYXNjJyA/IHJlcyA6IC1yZXM7XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIG1hdGNoZXMoQ291bnRyeUxpYjAwMzogQ291bnRyeUxpYjAwMywgdGVybTogc3RyaW5nLCBwaXBlOiBQaXBlVHJhbnNmb3JtKSB7XHJcbiAgcmV0dXJuIChcclxuICAgIENvdW50cnlMaWIwMDMubmFtZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHRlcm0pIHx8XHJcbiAgICBwaXBlLnRyYW5zZm9ybShDb3VudHJ5TGliMDAzLmFyZWEpLmluY2x1ZGVzKHRlcm0pIHx8XHJcbiAgICBwaXBlLnRyYW5zZm9ybShDb3VudHJ5TGliMDAzLnBvcHVsYXRpb24pLmluY2x1ZGVzKHRlcm0pXHJcbiAgKTtcclxufVxyXG5cclxuQEluamVjdGFibGUoeyBwcm92aWRlZEluOiAncm9vdCcgfSlcclxuZXhwb3J0IGNsYXNzIENvdW50cnlEYXRhU2VydmljZUxpYjAwMyB7XHJcbiAgcHJpdmF0ZSBDT01QT05FTlRfTkFNRSA9ICdDb3VudHJ5TGliMDAzRGF0YVNlcnZpY2UnO1xyXG4gIHByaXZhdGUgX2xvYWRpbmckID0gbmV3IEJlaGF2aW9yU3ViamVjdDxib29sZWFuPih0cnVlKTtcclxuICBwcml2YXRlIF9zZWFyY2gkID0gbmV3IFN1YmplY3Q8dm9pZD4oKTtcclxuICBwcml2YXRlIF9jb3VudHJpZXMkID0gbmV3IEJlaGF2aW9yU3ViamVjdDxDb3VudHJ5TGliMDAzW10+KFtdKTtcclxuICBwcml2YXRlIF90b3RhbCQgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PG51bWJlcj4oMCk7XHJcblxyXG4gIHByaXZhdGUgX3N0YXRlOiBTdGF0ZSA9IHtcclxuICAgIHBhZ2U6IDEsXHJcbiAgICBwYWdlU2l6ZTogNCxcclxuICAgIHNlYXJjaFRlcm06ICcnLFxyXG4gICAgc29ydENvbHVtbjogJycsXHJcbiAgICBzb3J0RGlyZWN0aW9uOiAnJyxcclxuICB9O1xyXG5cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHBpcGU6IERlY2ltYWxQaXBlKSB7XHJcbiAgICB0aGlzLl9zZWFyY2gkXHJcbiAgICAgIC5waXBlKFxyXG4gICAgICAgIHRhcCgoKSA9PiB0aGlzLl9sb2FkaW5nJC5uZXh0KHRydWUpKSxcclxuICAgICAgICBkZWJvdW5jZVRpbWUoMjAwKSxcclxuICAgICAgICBzd2l0Y2hNYXAoKCkgPT4gdGhpcy5fc2VhcmNoKCkpLFxyXG4gICAgICAgIGRlbGF5KDIwMCksXHJcbiAgICAgICAgdGFwKCgpID0+IHRoaXMuX2xvYWRpbmckLm5leHQoZmFsc2UpKVxyXG4gICAgICApXHJcbiAgICAgIC5zdWJzY3JpYmUoKHJlc3VsdCkgPT4ge1xyXG4gICAgICAgIHRoaXMuX2NvdW50cmllcyQubmV4dChyZXN1bHQuY291bnRyaWVzKTtcclxuICAgICAgICB0aGlzLl90b3RhbCQubmV4dChyZXN1bHQudG90YWwpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICB0aGlzLl9zZWFyY2gkLm5leHQoKTtcclxuICB9XHJcblxyXG4gIGdldCBjb3VudHJpZXMkKCkge1xyXG4gICAgY29uc29sZS5sb2codGhpcy5DT01QT05FTlRfTkFNRSArICcsIGNhbGxpbmcgZ2V0IGNvdW50cmllcyQgLi4uLi4gJyk7XHJcbiAgICByZXR1cm4gdGhpcy5fY291bnRyaWVzJC5hc09ic2VydmFibGUoKTtcclxuICB9XHJcbiAgZ2V0IHRvdGFsJCgpIHtcclxuICAgIHJldHVybiB0aGlzLl90b3RhbCQuYXNPYnNlcnZhYmxlKCk7XHJcbiAgfVxyXG4gIGdldCBsb2FkaW5nJCgpIHtcclxuICAgIHJldHVybiB0aGlzLl9sb2FkaW5nJC5hc09ic2VydmFibGUoKTtcclxuICB9XHJcbiAgZ2V0IHBhZ2UoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fc3RhdGUucGFnZTtcclxuICB9XHJcbiAgZ2V0IHBhZ2VTaXplKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX3N0YXRlLnBhZ2VTaXplO1xyXG4gIH1cclxuICBnZXQgc2VhcmNoVGVybSgpIHtcclxuICAgIHJldHVybiB0aGlzLl9zdGF0ZS5zZWFyY2hUZXJtO1xyXG4gIH1cclxuXHJcbiAgc2V0IHBhZ2UocGFnZTogbnVtYmVyKSB7XHJcbiAgICB0aGlzLl9zZXQoeyBwYWdlIH0pO1xyXG4gIH1cclxuICBzZXQgcGFnZVNpemUocGFnZVNpemU6IG51bWJlcikge1xyXG4gICAgdGhpcy5fc2V0KHsgcGFnZVNpemUgfSk7XHJcbiAgfVxyXG4gIHNldCBzZWFyY2hUZXJtKHNlYXJjaFRlcm06IHN0cmluZykge1xyXG4gICAgdGhpcy5fc2V0KHsgc2VhcmNoVGVybSB9KTtcclxuICB9XHJcbiAgc2V0IHNvcnRDb2x1bW4oc29ydENvbHVtbjogc3RyaW5nKSB7XHJcbiAgICB0aGlzLl9zZXQoeyBzb3J0Q29sdW1uIH0pO1xyXG4gIH1cclxuICBzZXQgc29ydERpcmVjdGlvbihzb3J0RGlyZWN0aW9uOiBTb3J0RGlyZWN0aW9uKSB7XHJcbiAgICB0aGlzLl9zZXQoeyBzb3J0RGlyZWN0aW9uIH0pO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBfc2V0KHBhdGNoOiBQYXJ0aWFsPFN0YXRlPikge1xyXG4gICAgT2JqZWN0LmFzc2lnbih0aGlzLl9zdGF0ZSwgcGF0Y2gpO1xyXG4gICAgdGhpcy5fc2VhcmNoJC5uZXh0KCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIF9zZWFyY2goKTogT2JzZXJ2YWJsZTxTZWFyY2hSZXN1bHQ+IHtcclxuICAgIGNvbnN0IHsgc29ydENvbHVtbiwgc29ydERpcmVjdGlvbiwgcGFnZVNpemUsIHBhZ2UsIHNlYXJjaFRlcm0gfSA9IHRoaXMuX3N0YXRlO1xyXG5cclxuICAgIC8vIDEuIHNvcnRcclxuICAgIGxldCBjb3VudHJpZXMgPSBzb3J0KENPVU5UUklFUywgc29ydENvbHVtbiwgc29ydERpcmVjdGlvbik7XHJcblxyXG4gICAgLy8gMi4gZmlsdGVyXHJcbiAgICBjb3VudHJpZXMgPSBjb3VudHJpZXMuZmlsdGVyKChDb3VudHJ5TGliMDAzKSA9PiBtYXRjaGVzKENvdW50cnlMaWIwMDMsIHNlYXJjaFRlcm0sIHRoaXMucGlwZSkpO1xyXG4gICAgY29uc3QgdG90YWwgPSBjb3VudHJpZXMubGVuZ3RoO1xyXG5cclxuICAgIC8vIDMuIHBhZ2luYXRlXHJcbiAgICBjb3VudHJpZXMgPSBjb3VudHJpZXMuc2xpY2UoKHBhZ2UgLSAxKSAqIHBhZ2VTaXplLCAocGFnZSAtIDEpICogcGFnZVNpemUgKyBwYWdlU2l6ZSk7XHJcbiAgICByZXR1cm4gb2YoeyBjb3VudHJpZXMsIHRvdGFsIH0pO1xyXG4gIH1cclxufVxyXG4iXX0=